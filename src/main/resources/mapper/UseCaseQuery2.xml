<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.benz.usecase.query.UseCaseQuery2">

    <resultMap id="useCaseResultMap" type="com.benz.usecase.query.UseCaseResult">
        <id column="id" property="id"/>
        <result column="subject" property="subject"/>
        <result column="value" property="value"/>
        <collection property="resultFiles" ofType="com.benz.usecase.query.FileResult">
            <result column="rurl" property="url"/>
            <result column="rfileName" property="fileName"/>
        </collection>
        <collection property="analysisModelFiles" ofType="com.benz.usecase.query.FileResult">
            <result column="aurl" property="url"/>
            <result column="afileName" property="fileName"/>
        </collection>
    </resultMap>

    <select id="findAll" resultType="com.benz.usecase.query.UseCaseResult">
        select
            id,
            subject,
            value,
            scenario,
            result,
            data_source,
            data_type_description
            analysis_model,
            contributionbu,
            stage,
            afrom_value,
            ato_value,
            contact
        from
            use_case
    </select>

    <select id="findById" resultMap="useCaseResultMap">
        select
            uc.id,
            subject,
            value,
            scenario,
            result_text,
            data_source,
            data_type_description,
            analysismodel_text,
            contributionbu,
            stage,
            afrom_value,
            ato_value,
            contact,
            rf.url as rurl,
            rf.file_name as rfileName,
            af.url as aurl,
            af.file_name as afileName
        from
            use_case uc
            left join result_file rf on uc.id = rf.case_id
            left join analysis_model_file af on uc.id=af.case_id
        where
            uc.id = #{id}
    </select>

</mapper>